{% extends 'aplicacion/profesor/base_profesor.html' %}

{% block title %}Resultados de Estudiantes{% endblock %}

{% block extra_css %}
<style>
    .resultados-container {
        max-width: 1050px;
        margin: 30px auto;
        padding: 25px;
        background: #f8fbff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(15, 76, 129, 0.08);
    }
    .resultados-header {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
    }
    .resultados-header h2 {
        margin: 0;
        color: #0f4c81;
    }
    .class-selector {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .class-selector select {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid #b6c8e3;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
    }
    th, td {
        padding: 10px 14px;
        border-bottom: 1px solid #eef2f7;
        text-align: left;
        font-size: 0.95em;
    }
    th {
        background: #0f4c81;
        color: #fff;
        text-transform: uppercase;
        font-size: 0.8em;
        letter-spacing: 0.04em;
    }
    tr:last-child td {
        border-bottom: none;
    }
    .badge {
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 0.85em;
        font-weight: 700;
        color: #fff;
    }
    .badge-fibra { background: #0f9d58; }
    .badge-cat6 { background: #0077B6; }
    .badge-cat3 { background: #ff6b6b; }
    .empty-state {
        text-align: center;
        color: #6c757d;
        padding: 30px 0;
    }
    .btn-guardar {
        background: linear-gradient(90deg,#0077B6,#0096c7);
        color: #fff;
        border: none;
        border-radius: 999px;
        font-weight: 700;
        cursor: pointer;
    }
    .btn-guardar:hover {
        opacity: 0.9;
    }
</style>
{% endblock %}

{% block content %}
<div class="resultados-container">
    <div class="resultados-header">
        <div>
            <h2>Resultados de Estudiantes</h2>
            <p style="margin:0;color:#4f5d75;">Visualiza los intentos registrados por clase.</p>
        </div>
        {% if clases %}
        <form method="get" class="class-selector">
            <label for="clase-select">Clase:</label>
            <select id="clase-select" name="clase">
                {% for clase in clases %}
                    <option value="{{ clase.id }}" {% if clase_seleccionada and clase.id == clase_seleccionada.id %}selected{% endif %}>
                        {{ clase.materia }} ({{ clase.codigo_acceso }})
                    </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn-guardar" style="padding:6px 16px;">Ver</button>
        </form>
        {% endif %}
    </div>

    {% if not clases %}
        <div class="empty-state">No tienes clases registradas aún.</div>
    {% elif not clase_seleccionada %}
        <div class="empty-state">Selecciona una clase para ver los resultados.</div>
    {% elif not intentos %}
        <div class="empty-state">Todavía no hay intentos registrados para esta clase.</div>
    {% else %}
        {# Tabla resumida de intentos realizados por los estudiantes de la clase seleccionada #}
        <table>
            <thead>
                <tr>
                    <th>Estudiante</th>
                    <th>Nivel</th>
                    <th>Puntaje</th>
                    <th>Clasificación</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody>
                {% for intento in intentos %}
                <tr>
                    <td>{{ intento.user.alias|default:intento.user.get_full_name|default:intento.user.username }}</td>
                    <td> Nivel {{ intento.level }}</td>
                    <td>{{ intento.score }}/10</td>
                    <td>
                        {% if intento.score >= 9 %}
                            <span class="badge badge-fibra">Fibra</span>
                        {% elif intento.score >= 7 %}
                            <span class="badge badge-cat6">UTP Cat 6</span>
                        {% else %}
                            <span class="badge badge-cat3">UTP Cat 3/5</span>
                        {% endif %}
                    </td>
                    <td>{{ intento.created_at|date:"d/m/Y H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>
{% endblock %}