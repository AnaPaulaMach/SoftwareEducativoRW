{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    
    <title>Nivel FINAL: Prueba Global</title>
    
    <!-- Favicon para Nivel FINAL -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèÜ</text></svg>">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nivel 2: Capa de Transporte</title>

    <!-- Favicon para Nivel 2 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöö</text></svg>">
    <link rel="stylesheet" href="{% static 'aplicacion/estudiante/niveles.css' %}">
    <link rel="stylesheet" href="{% static 'aplicacion/style.css' %}">
    <link rel="stylesheet" href="{% static 'aplicacion/estudiante/juego_final.css' %}">
</head>

<body>
    {% if user.is_authenticated %}

    <h1 class="title" style="margin-top: 30px; margin-bottom: 10px;">AVENTURA TCP/IP: CARRERA DE CAPAS üèÅ</h1>

    <div class="game-area">

        <div class="game-profile-meta">
            Jugando como: <strong>{{ user.alias|default:user.username }}</strong> | Rol: {{ user.rol }}
        </div>

        <h2 style="color: #0077B6; margin-bottom: 5px;">Nivel FINAL: Prueba de todas las capas vistas </h2>
        <p style="text-align: center; font-style: italic; margin-bottom: 15px;">Pregunta <span
                id="current-q-number">1</span> de 10. ¬°Cada acierto te acerca a la Fibra √ìptica!</p>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <form id="quiz-form" onsubmit="return false;">
            <div id="questions-container">
            </div>

            <div id="score-results" style="display: none;">
                <div class="score-display">Puntuaci√≥n Final: <span id="final-score"></span>/10</div>
                <div id="feedback-final" class="feedback"></div>

                <div id="review-container">
                    <h4>Revisi√≥n Detallada (Aciertos y Errores)</h4>
                    <div id="review-list"></div>
                </div>
            </div>

            <div class="nav-controls">
                <button type="button" id="prev-btn" disabled>‚Üê Anterior</button>
                <button type="button" id="check-btn">Verificar</button>
                <button type="button" id="next-btn" disabled>Siguiente ‚Üí</button>
                <button type="button" id="finish-btn" style="display:none;">Finalizar</button>
            </div>
        </form>

        <a href="{% url 'perfil_estudiante' %}" class="link-return" style="display: block; margin-top: 20px;">Volver al
            Men√∫ de Niveles</a>
    </div>

    <script>
        window.QUIZ_CONFIG = {
            saveResultUrl: "{% url 'save_quiz_result' %}",
            imgFibra: "{% static 'aplicacion/images/fibra.svg' %}",
            imgCat6: "{% static 'aplicacion/images/cat6.svg' %}",
            imgCat35: "{% static 'aplicacion/images/cat3_5.svg' %}"
        };

        // BANCO DE PREGUNTAS
        window.QUIZ_QUESTIONS = [

            {
                id: 1,
                type: "sequence",
                text: "Orden√° las capas del modelo TCP/IP de forma descendente, tal como las presentan Kurose y Ross.",
                sequence_items: [
                    { key: "red", label: "Capa de Red" },
                    { key: "aplicacion", label: "Capa de Aplicaci√≥n" },
                    { key: "enlace", label: "Capa de Enlace" },
                    { key: "transporte", label: "Capa de Transporte" },
                    { key: "fisica", label: "Capa F√≠sica" }
                ],
                // orden correcto (de arriba hacia abajo)
                correct_answer: [
                    "aplicacion",
                    "transporte",
                    "red",
                    "enlace",
                    "fisica"
                ],
                answer: [],          // empieza vac√≠o; el c√≥digo llenar√° esto al arrastrar
                checked: false,
                score_value: 1,
                pista: "Pens√° desde la capa m√°s cercana al usuario hacia la m√°s cercana al hardware.",
                correct_msg: "¬°Excelente! Ordenaste correctamente las capas del modelo TCP/IP.",
                incorrect_msg: "Incorrecto. Revis√° el orden descendente desde Aplicaci√≥n hasta F√≠sica."
            },
            {
                id: 2,
                type: "mc",
                singleSelect: true,  
                text: `
                En la imagen, el elemento marcado con el s√≠mbolo ‚Äú?‚Äù representa el punto donde la aplicaci√≥n 
                (en la Capa de Aplicaci√≥n) se comunica con la Capa de Transporte (como TCP o UDP). 
                Esta interfaz act√∫a como una puerta de software, permitiendo que el proceso pueda enviar y 
                recibir datos utilizando los servicios de transporte del sistema operativo.<br><br>

        <img src="/static/aplicacion/Imagenes/socket.png" width="500" style="max-width:100%; height:auto; border:1px solid #ccc; border-radius:6px;">
        <br><br>
        ¬øC√≥mo se llama esa interfaz?`,
                options: [
                    { value: "segmento", label: "Segmento" },
                    { value: "socket", label: "Socket" },
                    { value: "direccionIP", label: "Direcci√≥n IP" },
                    { value: "datagrama", label: "Datagrama" }
                ],

                correct_answer: ["socket"],

                answer: [],
                checked: false,
                score_value: 1,

                pista: "Es la interfaz que permite que las aplicaciones usen los servicios de transporte.",

                correct_msg: "¬°Correcto! El socket es la interfaz entre la aplicaci√≥n y la Capa de Transporte.",
                incorrect_msg: "Respuesta incorrecta. Observ√° la interfaz marcada en la imagen."
            },

            {
                id: 3,
                type: "tf",
                text: "La funci√≥n principal de la Capa de Enlace es trasladar un datagrama de la Capa de Red a trav√©s de un √∫nico enlace, desde un nodo hasta el siguiente en la ruta.",
                correct_answer: "verdadero",
                options: [
                    { value: "verdadero", label: "VERDADERO" },
                    { value: "falso", label: "FALSO" }
                ],
                pista: "Pens√° en qu√© hace la capa de enlace entre dos nodos vecinos, no en todo el recorrido extremo a extremo.",
                correct_msg: "¬°Correcto! La Capa de Enlace se encarga de mover un datagrama a trav√©s de un √∫nico enlace entre nodos adyacentes, como un salto dentro de la ruta.",
                incorrect_msg: "Incorrecto. Record√° que la Capa de Enlace opera solo entre nodos que comparten un enlace. El recorrido extremo a extremo es responsabilidad de la Capa de Red."
            },

            {
                id: 4,
                type: "tf",
                text: `La funci√≥n principal de la Capa de Red es mover una trama que contiene un datagrama entre nodos adyacentes a trav√©s de un √∫nico enlace de comunicaciones, 
                mientras que la Capa de Enlace tiene la responsabilidad de trasladar el datagrama del host de origen al host de destino a trav√©s de m√∫ltiples enlaces y routers.`,
                correct_answer: "falso",
                options: [
                    { value: "verdadero", label: "VERDADERO" },
                    { value: "falso", label: "FALSO" }
                ],

                pista: "Una capa trabaja ‚Äúsalto a salto‚Äù; la otra trabaja ‚Äúde origen a destino‚Äù. Pens√° cu√°l es cu√°l.",
                correct_msg: "¬°Correcto! La afirmaci√≥n es falsa porque describe al rev√©s las funciones. ",
                incorrect_msg: "Incorrecto. La descripci√≥n invierte las funciones."

            },
            {
                id: 5,
                type: "drag_drop",
                text: `En la arquitectura de cinco capas presentada por Kurose y Ross, cada capa maneja los datos en una unidad espec√≠fica. 
                Emparej√° cada capa con el nombre de la unidad de datos correspondiente. (Arrastrar)`,
                drag_items: [
                    { value: "trama", label: "Trama" },
                    { value: "mensaje", label: "Mensaje" },
                    { value: "datagrama", label: "Datagrama" },
                    { value: "bits", label: "Bits" },
                    { value: "segmento", label: "Segmento" }
                ],
                drop_zones: [
                    { function: "capa_aplicacion", label: "Capa de APLICACI√ìN", active: true },
                    { function: "capa_trasporte", label: "Capa de TRANSPORTE", active: true },
                    { function: "capa_red", label: "Capa de RED", active: true },
                    { function: "capa_enlace", label: "Capa de ENLACE", active: true },
                    { function: "capa_fisica", label: "Capa F√çSICA", active: true }
                ],

                correct_map: {
                    capa_aplicacion: "mensaje",
                    capa_trasporte: "segmento",
                    capa_red: "datagrama",
                    capa_enlace: "trama",
                    capa_fisica: "bits"
                },

                checked: false,
                score_value: 1,
                pista: `Record√° que cada capa agrega su propia informaci√≥n (encapsulaci√≥n). 
                <br> La unidad de datos cambia a medida que bajamos: mensaje ‚Üí ... ‚Üí bits.`,
                correct_msg: "¬°Excelente! La encapsulaci√≥n sigue exactamente ese orden en el modelo descendente de Kurose y Ross.",
                incorrect_msg: "Incorrecto. Algunas asociaciones no son correctas."
            },
            {
                id: 6,
                type: "mc", // multiple-choice simple
                singleSelect: true,  
                text: "¬øA qu√© capa corresponden los protocolos de la imagen?",
                image: "/static/aplicacion/Imagenes/protocolosdeaplicacion.jpg", // ruta de la imagen
                options: [
                    { value: "capadered", label: "Capa de RED" },
                    { value: "capadeenlace", label: "Capa de ENLACE" },
                    { value: "capadeapp", label: "Capa de APLICACI√ìN" },
                    { value: "capadetransporte", label: "Capa de TRANSPORTE" }
                ],
                correct_answer: "capadeapp",
                checked: false,
                score_value: 1,
                pista: "Estos protocolos permiten que las aplicaciones del usuario funcionen y se comuniquen a trav√©s de la red.",
                correct_msg: "¬°Correcto! Estos protocolos pertenecen a la capa de aplicaci√≥n",
                incorrect_msg: "Incorrecto. Revis√° qu√© capa trabaja directamente con las aplicaciones y servicios que usamos en la red."
            },
            {
                id: 7,
                type: "mc",
                singleSelect: true,  
                text: "¬øC√≥mo logra la capa de Transporte entregar los datos recibidos de la capa de Red al proceso correcto de la capa de Aplicaci√≥n?",
                options: [
                    { value: "multiplexacion", label: "Usando multiplexaci√≥n y desmultiplexaci√≥n con n√∫meros de puerto" },
                    { value: "solo_ip", label: "Usando √∫nicamente la direcci√≥n IP del host receptor" },
                    { value: "tcp_udp", label: "Combinando TCP y UDP para determinar a qu√© proceso enviar los datos" },
                    { value: "orden_paquetes", label: "Ordenando los paquetes en el mismo orden en que llegaron sin diferenciar procesos" }
                ],
                correct_answer: "multiplexacion",
                checked: false,
                score_value: 1,
                pista: "Observ√° c√≥mo la capa de Transporte distingue entre distintos procesos en el mismo host, ¬øqu√© mecanismo podr√≠a usar?",
                correct_msg: "¬°Correcto! La capa de Transporte usa multiplexaci√≥n y desmultiplexaci√≥n para entregar los datos al proceso adecuado seg√∫n el n√∫mero de puerto.",
                incorrect_msg: "Incorrecto. Para entregar los datos que recibe de capa de red usa multiplexaci√≥n y desmultiplexaci√≥n "
            },
            {
                id: 8,
                type: "mc", // multiple-choice
                text: "¬øQu√© funciones son realizadas por la CAPA DE RED del modelo TCP/IP? (3 opciones correctas)",
                options: [
                    { value: "routing", label: "Encaminamiento de paquetes mediante algoritmos de routing" },
                    { value: "ip", label: "Asignaci√≥n y uso de direcciones IP para el env√≠o entre redes" },
                    { value: "dns", label: "Traducci√≥n de nombres de dominio (DNS)" },
                    { value: "flujo", label: "Control de flujo extremo a extremo" },
                    { value: "conmutacion", label: "Conmutaci√≥n y transporte de datagramas desde el host origen hacia el host destino" }

                ],
                correct_answer: ["routing", "ip", "conmutacion"], // las que no se ofrecen
                checked: false,
                score_value: 1,
                pista: "Reflexion√° sobre lo siguiente: ¬øInternet puede asegurar tiempos de entrega o que los datos viajen a una velocidad constante?",
                correct_msg: "¬°Correcto! La capa de transporte no garantiza retardo ni ancho de banda.",
                incorrect_msg: "Incorrecto. La capa de transporte lo que no garantiza es retardo ni ancho de banda."
        },
        {
            id: 9, 
            type: 'drag_drop', 
            text: " CAPA DE APLICACI√ìN - ¬°Asocia la funci√≥n con el Protocolo que la realiza!",
            
            drag_items: [
                { value: 'web_request', label: 'Petici√≥n de una p√°gina web' },
                { value: 'mail_address', label: 'Traducci√≥n de nombre a IP' },
                { value: 'encrypted_remote', label: 'Acceso remoto cifrado' },
                { value: 'mailbox_access', label: 'Gesti√≥n de tu buz√≥n de correo' }
            ],

            drop_zones: [
                { function: 'http_p', label: 'Protocolo HTTP/S', active: true },
                { function: 'dns_p', label: 'Protocolo DNS', active: true },
                { function: 'ssh_p', label: 'Protocolo SSH', active: true },
                { function: 'imap_p', label: 'Protocolo IMAP', active: true }
            ],

            correct_map: { 
                'http_p': 'web_request',
                'dns_p': 'mail_address',
                'ssh_p': 'encrypted_remote',
                'imap_p': 'mailbox_access'
            },

            answer: {},
            checked: false,
            
            score_value: 1,

            pista: "Recuerda la funci√≥n principal de cada protocolo: ¬øCu√°l est√° asociado con la encriptaci√≥n? ¬øCu√°l usa TCP en el puerto 80/443? ¬øCu√°l almacena mensajes en el buz√≥n?",
            correct_msg: "¬°Correcto! ",
            incorrect_msg: "Incorrecto. "
        },

        {
            id: 10,
            type: "sequence",
            text: "CAPA DE RED - Ordena de forma simplificada el recorrido de un datagrama IP desde un host de origen hasta un servidor remoto.",

            sequence_items: [
                { key: "routers_intermedios", label: "Routers intermedios reenv√≠an el datagrama hacia la red destino" },
                { key: "origen", label: "Host de origen env√≠a el datagrama a su router de borde" },
                { key: "router_destino", label: "Router de la red destino entrega el datagrama a la red local" },
                { key: "router_local", label: "Router local consulta su tabla de enrutamiento" },
                { key: "host_destino", label: "Host de destino recibe el datagrama y lo pasa a la capa superior" }
            ],

            correct_answer: [
                "origen",
                "router_local",
                "routers_intermedios",
                "router_destino",
                "host_destino"
            ],

            answer: [],
            checked: false,
            score_value: 1,

            pista: "Pens√° en el camino que recorre un datagrama: primero el host, luego routers, y por √∫ltimo el destino.",
            correct_msg: "¬°Muy bien! Ese es el orden correcto en el recorrido de un datagrama IP.",
            incorrect_msg: "Incorrecto. Revis√° el flujo desde el host origen hasta el destino final.",
        },
        {
            id: 12,
            type: "mc",
            singleSelect: true,  // <-- aqu√≠ indicamos que solo se puede seleccionar una opci√≥n
            text: `CAPA DE ENLACE ‚Äì ¬øQu√© tipo de unidad de datos es la que aparece en la imagen?<br><br>
            <img src="/static/aplicacion/Imagenes/tramaethernet.png" width="700" style="max-width:100%; height:auto; border:1px solid #ccc; border-radius:6px;">
            <br>`,
            options: [
                { value: "trama1", label: "Trama 802.11 (Wi-Fi)" },
                { value: "trama2", label: "Trama PPP (Point-to-Point Protocol)" },
                { value: "trama3", label: "Trama HDLC" },
                { value: "trama4", label: "Trama Ethernet" }
            ],
            correct_answer: ["trama4"],
            answer: [],
            checked: false,
            score_value: 1,
            pista: "Observ√° si aparecen direcciones f√≠sicas (MAC) de origen y destino y un campo Type. " +
                "Estos campos son caracter√≠sticos de un protocolo de acceso m√∫ltiple de capa de enlace ampliamente utilizado en redes LAN.",
            correct_msg: "¬°Correcto! La unidad de datos mostrada es una trama Ethernet",
            incorrect_msg: "Incorrecto. Revis√° nuevamente: si ves direcciones MAC y un campo Type, est√°s ante una trama utilizada en redes LAN cableadas"
        }
];
</script>

    <script src="{% static 'aplicacion/estudiante/juego_final.js' %}"></script>
    {% else %}
    <h1>Acceso Denegado</h1>
    <p>Necesitas iniciar sesi√≥n para ver esta p√°gina.</p>
    </div>
    {% endif %}

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-inner">
            <!-- Bloque izquierdo: Marca + cr√©ditos -->
            <div class="footer-left">
                <p class="footer-brand">Aventura TCP/IP</p>
                <p class="footer-meta">
                    Desarrollado por: Coria Luz Antonella, Proserpio Eliana Naily y Ana Paula Machado
                </p>
                <p class="footer-meta">
                    Asignatura Optativa: Inform√°tica Educativa ¬∑ Licenciatura en Sistemas de Informaci√≥n ¬∑ UNSE ¬∑ 2025
                </p>
                <!-- Bibliograf√≠a -->
                <p class="footer-meta footer-biblio">
                    Basado en contenidos de: Redes de Computadoras. Un Enfoque Descendente (7ma Ed.)
                </p>
                <!-- Uso √©tico de IA -->
                <p class="footer-meta footer-ai">
                    Herramientas de apoyo utilizadas: ChatGPT, Gemini y NotebookLM
                </p>
            </div>
            <!-- Bloque derecho: etiquetas -->
            <div class="footer-right">
                <span class="footer-tag">Proyecto acad√©mico</span>
                <span class="footer-tag footer-role">Versi√≥n 1.0</span>
            </div>
        </div>
    </footer>
</body>

</html>