{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil del Estudiante</title>

    <!-- Favicon para Estudiante -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">

    <!-- Cargamos los estilos externos -->
    <link rel="stylesheet" href="{% static 'aplicacion/style.css' %}">
</head>

<body>
    <script>
        // Limpieza inmediata: eliminar cualquier flag antiguo de desbloqueo antes de procesar la UI
        try { localStorage.removeItem('unlocked_level_2'); } catch (e) { /* ignore */ }
    </script>

    <!-- TÃTULO DE LA APLICACIÃ“N: FUERA de la tarjeta -->
    <h1 class="title">AVENTURA TCP/IP: CARRERA DE CAPAS ğŸ</h1>
    <!-- Contenedor principal de la tarjeta de perfil -->

    <div class="profile-container">

        {% if user.is_authenticated %}

        <!-- CONTENEDOR DEL ALIAS Y ROL (MUESTRA INFORMACIÃ“N DEL PERFIL) -->
        <div class="profile-meta">
            <div class="profile-info">
                ğŸ“ Alias: <strong>{{ user.alias|default:user.username }}</strong> | Rol: {{ user.rol }}
            </div>
            <a href="{% url 'logout' %}" class="btn-cerrar-sesion">Cerrar SesiÃ³n</a>
        </div>

        <div class="profile-header">
            <h1>ğŸ“ Â¡Bienvenido/a, {{ user.first_name }} {{ user.last_name }}!</h1>
            <p><strong>Carrera:</strong> {{ clase.carrera }} || <strong>Materia:</strong> {{ clase.materia }} </p>
            <p><strong>Profesor:</strong> {{ clase.profesor.username }} || <strong>CÃ³digo de Clase:</strong>
                <strong>{{clase.codigo_acceso }}</strong></p>
                                            <hr style="margin-top: 30px;">

        </div>

        <!-- SecciÃ³n de Niveles del Juego -->
        <h3 style="text-align: center; color: #0077B6; margin-bottom: 30px;">Elige la Capa para Iniciar la Carrera</h3>

        <div class="game-levels">

            <!-- NIVEL 1: CAPA DE APLICACIÃ“N (Desbloqueado) -->
            {# Evaluamos estado del nivel segÃºn la configuraciÃ³n del profesor #}
            {% with nivel1=niveles_habilitados.1 %}
            <div class="level-card {% if nivel1 %}unlocked{% else %}locked{% endif %}">
                {% if not nivel1 %}
                <span class="locked-icon">ğŸ”’</span>
                {% endif %}
                <h3>ğŸ“± Nivel 1</h3>
                <p>Capa de AplicaciÃ³n</p>
                <a href="{% if nivel1 %}{% url 'juego_capa_1' %}{% else %}#{% endif %}" class="level-button">
                    {% if nivel1 %}INICIAR{% else %}BLOQUEADO{% endif %}
                </a>
                {% if not nivel1 %}
                    <p class="level-note">Nivel bloqueado por el profesor.</p>
                {% endif %}
            </div>
            {% endwith %}

            <!-- NIVEL 2: CAPA DE TRANSPORTE -->
            {% with nivel2=niveles_habilitados.2 %}
            {% if puede_jugar_nivel_2 %}
            <div id="level-2-card" class="level-card unlocked">
                <h3>ğŸšš Nivel 2</h3>
                <p>Capa de Transporte</p>
                <a href="{% url 'juego_capa_2' %}" class="level-button" id="level-2-button">
                    INICIAR
                </a>
            </div>
            {% else %}
            <div id="level-2-card" class="level-card locked">
                <span class="locked-icon">ğŸ”’</span>
                <h3>Nivel 2</h3>
                <p>Capa de Transporte</p>
                <a href="#" class="level-button" id="level-2-button">
                    BLOQUEADO
                </a>
                <p class="level-note">
                    {% if not nivel2 %}
                        Nivel bloqueado por el profesor.
                    {% else %}
                        Debes completar el nivel anterior para continuar.
                    {% endif %}
                </p>
            </div>
            {% endif %}
            {% endwith %}

            <!-- NIVEL 3: CAPA DE RED (Bloqueado) -->
            <div class="level-card locked">
                <span class="locked-icon">ğŸ”’</span>
                <h3>ğŸŒ Nivel 3</h3>
                <p>Capa de Red</p>
                <a href="#" class="level-button">
                    BLOQUEADO
                </a>
            </div>

            <!-- NIVEL 4: CAPA DE ENLACE (Bloqueado) -->
            <div class="level-card locked">
                <span class="locked-icon">ğŸ”’</span>
                <h3>ğŸ”— Nivel 4</h3>
                <p>Capa de Enlace</p>
                <a href="#" class="level-button">
                    BLOQUEADO
                </a>
            </div>

            <!-- NIVEL 5: CAPA FÃSICA (Bloqueado) -->
            <div class="level-card locked">
                <span class="locked-icon">ğŸ”’</span>
                <h3>âš¡ Nivel 5</h3>
                <p>Capa FÃ­sica</p>
                <a href="#" class="level-button">
                    BLOQUEADO
                </a>
            </div>

            <!-- Nivel FINAL -->
            <div class="level-card locked">
                <span class="locked-icon">ğŸ”’</span>
                <h3>ğŸ† FINAL</h3>
                <p>Prueba Global</p>
                <a href="#" class="level-button">
                    BLOQUEADO
                </a>
            </div>
        </div>

        {% else %}
        <h1>Acceso Denegado</h1>
        <p>Necesitas iniciar sesiÃ³n para ver esta pÃ¡gina.</p>
        {% endif %}

        <p style="margin-top:30px; text-align:center;">
            <a href="{% url 'salir_clase' %}" class="btn btn-warning">
                Salir e ingresar con otro cÃ³digo
            </a>

        </p>

    </div>

    <script>
        // Sincronizar localStorage con el estado del servidor.
        // Ya no permitimos que un valor antiguo en localStorage fuerce el desbloqueo.
        (function () {
            try {
                var serverUnlocked = "{{ unlocked_level_2|yesno:'true,false' }}" === "true";
                if (serverUnlocked) {
                    try { localStorage.setItem('unlocked_level_2', 'true'); } catch (e) { }
                } else {
                    try { localStorage.removeItem('unlocked_level_2'); } catch (e) { }
                }
            } catch (e) {
                console.warn('No se pudo sincronizar localStorage para desbloqueo de niveles.');
            }
        })();
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-inner">
            <!-- Lado izquierdo (marca + info) -->
            <div class="footer-left">
                <p class="footer-brand">Aventura TCP/IP</p>
                <p class="footer-meta">
                    Desarrollado por: Coria Luz Antonella, Proserpio Eliana Naily y Ana Paula Machado
                </p>
                <p class="footer-meta">
                    InformÃ¡tica Educativa Â· Licenciatura en Sistemas de InformaciÃ³n Â· UNSE Â· 2025
                </p>
            </div>
            <!-- Lado derecho (tags estilo moderno) -->
            <div class="footer-right">
                <span class="footer-tag">Proyecto acadÃ©mico</span>
                <span class="footer-tag footer-role">VersiÃ³n 1.0</span>
            </div>
        </div>
    </footer>

</body>

</html>