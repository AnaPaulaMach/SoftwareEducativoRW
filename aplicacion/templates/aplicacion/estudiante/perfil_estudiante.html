{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil del Estudiante</title>

    <!-- Favicon para Estudiante -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéì</text></svg>">

    <!-- Cargamos los estilos externos -->
    <link rel="stylesheet" href="{% static 'aplicacion/style.css' %}">
</head>

<body>
    <script>
        // Limpieza inmediata: eliminar cualquier flag antiguo de desbloqueo antes de procesar la UI
        try { localStorage.removeItem('unlocked_level_2'); } catch (e) { /* ignore */ }
    </script>

    <!-- T√çTULO DE LA APLICACI√ìN: FUERA de la tarjeta -->
    <h1 class="title">AVENTURA TCP/IP: CARRERA DE CAPAS üèÅ</h1>
    <!-- Contenedor principal de la tarjeta de perfil -->

    <div class="profile-container">

        {% if user.is_authenticated %}

        <!-- CONTENEDOR DEL ALIAS Y ROL (MUESTRA INFORMACI√ìN DEL PERFIL) -->
        <div class="profile-meta">
            <div class="profile-info">
                üéì Alias: <strong>{{ user.alias|default:user.username }}</strong> | Rol: {{ user.rol }}
            </div>
            <a href="{% url 'logout' %}" class="btn-cerrar-sesion">Cerrar Sesi√≥n</a>
        </div>

        <div class="profile-header">
            <h1>üéì ¬°Bienvenido/a, {{ user.first_name }} {{ user.last_name }}!</h1>
            <p><strong>Carrera:</strong> {{ clase.carrera }} || <strong>Materia:</strong> {{ clase.materia }} </p>
            <p><strong>Profesor:</strong> {{ clase.profesor.username }} || <strong>C√≥digo de Clase:</strong>
                <strong>{{clase.codigo_acceso }}</strong></p>
                                            <hr style="margin-top: 30px;">

        </div>

        <!-- Secci√≥n de Niveles del Juego -->
        <h3 style="text-align: center; color: #0077B6; margin-bottom: 30px;">Elige la Capa para Iniciar la Carrera</h3>

        <div class="game-levels">

            <!-- NIVEL 1: CAPA DE APLICACI√ìN (Desbloqueado) -->
            {# Evaluamos estado del nivel seg√∫n la configuraci√≥n del profesor #}
            {% with nivel1=niveles_habilitados.1 %}
            <div class="level-card {% if nivel1 %}unlocked{% else %}locked{% endif %}">
                {% if not nivel1 %}
                <span class="locked-icon">üîí</span>
                {% endif %}
                <h3>üì± Nivel 1</h3>
                <p>Capa de Aplicaci√≥n</p>
                <a href="{% if nivel1 %}{% url 'juego_capa_1' %}{% else %}#{% endif %}" class="level-button">
                    {% if nivel1 %}INICIAR{% else %}BLOQUEADO{% endif %}
                </a>
                {% if not nivel1 %}
                    <p class="level-note">Nivel bloqueado por el profesor.</p>
                {% endif %}
            </div>
            {% endwith %}

            <!-- NIVEL 2: CAPA DE TRANSPORTE -->
            {% with nivel2=niveles_habilitados.2 %}
            {% if puede_jugar_nivel_2 %}
            <div id="level-2-card" class="level-card unlocked">
                <h3>üöö Nivel 2</h3>
                <p>Capa de Transporte</p>
                <a href="{% url 'juego_capa_2' %}" class="level-button" id="level-2-button">
                    INICIAR
                </a>
            </div>
            {% else %}
            <div id="level-2-card" class="level-card locked">
                <span class="locked-icon">üîí</span>
                <h3>Nivel 2</h3>
                <p>Capa de Transporte</p>
                <a href="#" class="level-button" id="level-2-button">
                    BLOQUEADO
                </a>
                <p class="level-note">
                    {% if not nivel2 %}
                        Nivel bloqueado por el profesor.
                    {% else %}
                        Debes completar el nivel anterior para continuar.
                    {% endif %}
                </p>
            </div>
            {% endif %}
            {% endwith %}

            <!-- NIVEL 3: CAPA DE RED -->
            {% with nivel3=niveles_habilitados.3 %}
            {% if puede_jugar_nivel_3 %}
            <div class="level-card unlocked">
                <h3>üåê Nivel 3</h3>
                <p>Capa de Red</p>
                <a href="{% url 'juego_capa_3' %}" class="level-button">
                    INICIAR
                </a>
            </div>
            {% else %}
            <div class="level-card locked">
                <span class="locked-icon">üîí</span>
                <h3>üåê Nivel 3</h3>
                <p>Capa de Red</p>
                <a href="#" class="level-button">
                    BLOQUEADO
                </a>
                <p class="level-note">
                    {% if not nivel3 %}
                        Nivel bloqueado por el profesor.
                    {% else %}
                        Debes completar el nivel anterior para continuar.
                    {% endif %}
                </p>
            </div>
            {% endif %}
            {% endwith %}

            <!-- NIVEL 4: CAPA DE ENLACE -->
            {% with nivel4=niveles_habilitados.4 %}
            {% if puede_jugar_nivel_4 %}
            <div class="level-card unlocked">
                <h3>üîó Nivel 4</h3>
                <p>Capa de Enlace</p>
                <a href="{% url 'juego_capa_4' %}" class="level-button">
                    INICIAR
                </a>
            </div>
            {% else %}
            <div class="level-card locked">
                <span class="locked-icon">üîí</span>
                <h3>üîó Nivel 4</h3>
                <p>Capa de Enlace</p>
                <a href="#" class="level-button">
                    BLOQUEADO
                </a>
                <p class="level-note">
                    {% if not nivel4 %}
                        Nivel bloqueado por el profesor.
                    {% else %}
                        Debes completar el nivel anterior para continuar.
                    {% endif %}
                </p>
            </div>
            {% endif %}
            {% endwith %}

            <!-- NIVEL 5: CAPA F√çSICA -->
            {% with nivel5=niveles_habilitados.5 %}
            {% if puede_jugar_nivel_5 %}
            <div class="level-card unlocked">
                <h3>‚ö° Nivel 5</h3>
                <p>Capa F√≠sica</p>
                <a href="{% url 'juego_capa_5' %}" class="level-button">
                    INICIAR
                </a>
            </div>
            {% else %}
            <div class="level-card locked">
                <span class="locked-icon">üîí</span>
                <h3>‚ö° Nivel 5</h3>
                <p>Capa F√≠sica</p>
                <a href="#" class="level-button">
                    BLOQUEADO
                </a>
                <p class="level-note">
                    {% if not nivel5 %}
                        Nivel bloqueado por el profesor.
                    {% else %}
                        Debes completar el nivel anterior para continuar.
                    {% endif %}
                </p>
            </div>
            {% endif %}
            {% endwith %}

            <!-- Nivel FINAL -->
            {% with nivel6=niveles_habilitados.6 %}
            {% if puede_jugar_nivel_final %}
            <div class="level-card unlocked">
                <h3>üèÜ FINAL</h3>
                <p>Prueba Global</p>
                <a href="{% url 'juego_final' %}" class="level-button">
                    INICIAR
                </a>
            </div>
            {% else %}
            <div class="level-card locked">
                <span class="locked-icon">üîí</span>
                <h3>üèÜ FINAL</h3>
                <p>Prueba Global</p>
                <a href="#" class="level-button">
                    BLOQUEADO
                </a>
                <p class="level-note">
                    {% if not nivel6 %}
                        Nivel bloqueado por el profesor.
                    {% else %}
                        Debes completar el nivel anterior para continuar.
                    {% endif %}
                </p>
            </div>
            {% endif %}
            {% endwith %}
        </div>

        {% else %}
        <h1>Acceso Denegado</h1>
        <p>Necesitas iniciar sesi√≥n para ver esta p√°gina.</p>
        {% endif %}

        <p style="margin-top:30px; text-align:center;">
            <a href="{% url 'salir_clase' %}" class="btn btn-warning">
                Salir e ingresar con otro c√≥digo
            </a>

        </p>

    </div>

    <script>
        // Sincronizar localStorage con el estado del servidor.
        // Ya no permitimos que un valor antiguo en localStorage fuerce el desbloqueo.
        (function () {
            try {
                var serverUnlocked = "{{ unlocked_level_2|yesno:'true,false' }}" === "true";
                if (serverUnlocked) {
                    try { localStorage.setItem('unlocked_level_2', 'true'); } catch (e) { }
                } else {
                    try { localStorage.removeItem('unlocked_level_2'); } catch (e) { }
                }
            } catch (e) {
                console.warn('No se pudo sincronizar localStorage para desbloqueo de niveles.');
            }
        })();
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-inner">
            <!-- Bloque izquierdo: Marca + cr√©ditos -->
            <div class="footer-left">
                <p class="footer-brand">Aventura TCP/IP</p>
                <p class="footer-meta">
                    Desarrollado por: Coria Luz Antonella, Proserpio Eliana Naily y Ana Paula Machado
                </p>
                <p class="footer-meta">
                    Asignatura Optativa: Inform√°tica Educativa ¬∑ Licenciatura en Sistemas de Informaci√≥n ¬∑ UNSE ¬∑ 2025
                </p>
                <!-- Bibliograf√≠a -->
                <p class="footer-meta footer-biblio">
                    Basado en contenidos de: Redes de Computadoras. Un Enfoque Descendente (7ma Ed.)
                </p>
                <!-- Uso √©tico de IA -->
                <p class="footer-meta footer-ai">
                    Herramientas de apoyo utilizadas: ChatGPT, Gemini y NotebookLM
                </p>
            </div>
            <!-- Bloque derecho: etiquetas -->
            <div class="footer-right">
                <span class="footer-tag">Proyecto acad√©mico</span>
                <span class="footer-tag footer-role">Versi√≥n 1.0</span>
            </div>
        </div>
    </footer>

</body>

</html>