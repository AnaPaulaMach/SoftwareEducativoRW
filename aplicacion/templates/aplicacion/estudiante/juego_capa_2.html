{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Nivel 2: Capa de Transporte</title>

    <!-- Favicon para Nivel 2 -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöö</text></svg>">
    <link rel="stylesheet" href="{% static 'aplicacion/estudiante/niveles.css' %}">
    <link rel="stylesheet" href="{% static 'aplicacion/style.css' %}">
    <link rel="stylesheet" href="{% static 'aplicacion/estudiante/capa2.css' %}">
</head>

<body>
    {% if user.is_authenticated %}

    <h1 class="title" style="margin-top: 30px; margin-bottom: 10px;">AVENTURA TCP/IP: CARRERA DE CAPAS üèÅ</h1>

    <div class="game-area">

        <div class="game-profile-meta">
            Jugando como: <strong>{{ user.alias|default:user.username }}</strong> | Rol: {{ user.rol }}
        </div>

        <h2 style="color: #0077B6; margin-bottom: 5px;">Nivel 2: Capa de Transporte</h2>
        <p style="text-align: center; font-style: italic; margin-bottom: 15px;">Pregunta <span
                id="current-q-number">1</span> de 10. ¬°Cada acierto te acerca a la Fibra √ìptica!</p>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <form id="quiz-form" onsubmit="return false;">
            <div id="questions-container">
            </div>

            <div id="score-results" style="display: none;">
                <div class="score-display">Puntuaci√≥n Final: <span id="final-score"></span>/10</div>
                <div id="feedback-final" class="feedback"></div>

                <div id="review-container">
                    <h4>Revisi√≥n Detallada (Aciertos y Errores)</h4>
                    <div id="review-list"></div>
                </div>
            </div>

            <div class="nav-controls">
                <button type="button" id="prev-btn" disabled>‚Üê Anterior</button>
                <button type="button" id="check-btn">Verificar</button>
                <button type="button" id="next-btn" disabled>Siguiente ‚Üí</button>
                <button type="button" id="finish-btn" style="display:none;">Finalizar</button>
            </div>
        </form>

        <a href="{% url 'perfil_estudiante' %}" class="link-return" style="display: block; margin-top: 20px;">Volver al
            Men√∫ de Niveles</a>
    </div>

<script>
        window.QUIZ_CONFIG = {
            saveResultUrl: "{% url 'save_quiz_result' %}",
            imgFibra: "{% static 'aplicacion/images/fibra.svg' %}",
            imgCat6: "{% static 'aplicacion/images/cat6.svg' %}",
            imgCat35: "{% static 'aplicacion/images/cat3_5.svg' %}",
            videoTCP: "{% static 'aplicacion/videos/establecimientoTCP.mp4' %}",
            imgSegmentoTCP: "{% static 'aplicacion/Imagenes/segmentoTCP.png' %}",
            imgSegmentoUDP: "{% static 'aplicacion/Imagenes/segmentoUDP.png' %}",
            imgCierreConexion: "{% static 'aplicacion/Imagenes/cierredeconexion.png' %}"
        };

        // BANCO DE PREGUNTAS
        window.QUIZ_QUESTIONS = [
            {
                id: 1,
                type: 'drag_drop',
                text: "Complete los dos campos faltantes de la cabecera del segmento UDP. (Arrastre a los recuadros sin texto)",
                drag_items: [
                    { value: 'puerto_dest', label: 'N¬∞ puerto destino' },
                    { value: 'longitud', label: 'Longitud' },
                    { value: 'numsec', label: 'N¬∞ de secuencia' },
                    { value: 'ventanarec', label: 'Ventana de Recepci√≥n' }
                ],

                drop_zones: [
                    { function: 'campo1', label: 'N¬∞ puerto origen', active: false },
                    { function: 'campo2', label: '_____', active: true },
                    { function: 'campo3', label: '_____', active: true },
                    { function: 'campo4', label: 'Checksum', active: false },
                    { function: 'campo5', label: 'Datos de Aplicaci√≥n (MENSAJE)', active: false },
                ],

                correct_map: {
                    'campo2': 'puerto_dest',
                    'campo3': 'longitud'
                },

                answer: {},
                checked: false,
                score_value: 1,
                //explanation: "Campos correctos: N¬∞ puerto destino y Longitud.",
                pista: "Uno de los campos indica a d√≥nde va el segmento y el otro est√° relacionado con su tama√±o.",
                correct_msg: "¬°Excelente! Completaste correctamente los campos del segmento UDP.",
                incorrect_msg: "Incorrecto. Revis√° si los campos que elegiste pertenecen a UDP y si est√°n en el orden correcto."

            },

            {
                id: 2,
                type: "mc",
                text: "Seleccione las caracter√≠sticas que corresponden al protocolo TCP. (4 opciones)",

                options: [
                    { value: "bidireccional", label: "Permite la transferencia bidireccional de datos" },
                    { value: "orientado_conexion", label: "Es orientado a la conexi√≥n" },
                    { value: "control_flujo", label: "Implementa control de flujo" },
                    { value: "no_conexion", label: "No requiere establecer una conexi√≥n previa" },
                    { value: "sin_control", label: "No realiza control de flujo" },
                    { value: "mss", label: "Utiliza el par√°metro MSS para indicar el tama√±o m√°ximo del segmento" }

                ],

                // Respuestas correctas (pueden ser varias)
                correct_answer: [
                    "bidireccional",
                    "orientado_conexion",
                    "control_flujo",
                    "mss"
                ],

                answer: [],       // El jugador marcar√° aqu√≠
                checked: false,
                score_value: 1,
                pista:"TCP requiere establecer una conexi√≥n y controlar el flujo, por eso incluye m√°s campos que UDP.",
                correct_msg: "¬°Bien hecho! Todas las opciones seleccionadas corresponden a TCP.",
                incorrect_msg: "Hay elecciones incorrectas."
            },

            {
                id: 3,
                type: "tf",
                text: `Indique si es verdadero o falso el proceso de Establecimiento de Conexi√≥n mencionado en el video.<br><br>
         <video width="600" heigth: "auto" controls>
           <source src="${window.QUIZ_CONFIG.videoTCP}" type="video/mp4">
         </video>`,
                correct_answer: "verdadero",
                options: [
                    { value: "verdadero", label: "VERDADERO" },
                    { value: "falso", label: "FALSO" }
                ],
                pista: "TCP establece la conexi√≥n mediante tres fases antes de transmitir datos, asegurando una comunicaci√≥n confiable.",
                correct_msg: "¬°Muy bien! El video muestra correctamente el establecimiento de tres fases en TCP.",
                incorrect_msg: "Incorrecto."
            },

            {
                id: 4,
                type: "tf",
                text: `La capa de transporte provee la comunicaci√≥n l√≥gica entre las diversas aplicaciones de red.
                El servicio brindado se implementa a trav√©s de los protocolos de la capa de transporte. <br>
                En internet se cuenta unicamente con el protocolo TCP.`,
                correct_answer: "falso",
                options: [
                    { value: "verdadero", label: "VERDADERO" },
                    { value: "falso", label: "FALSO" }
                ],

                pista: "UDP es un protocolo de capa de tranporte que se utiliza para transmisi√≥n de datos sin conexi√≥n, como en streaming",
                correct_msg: "¬°Muy bien! Adem√°s de TCP, en Internet existe el protocolo UDP.",
                incorrect_msg: "Incorrecto. TCP y UDP son los protocolos de capa de tranporte en internet."

            },

            {
                id: 5,
                type: "mc",
                text: "¬øC√≥mo logra la capa de Transporte entregar los datos recibidos de la capa de Red al proceso correcto de la capa de Aplicaci√≥n?",
                options: [
                    { value: "multiplexacion", label: "Usando multiplexaci√≥n y desmultiplexaci√≥n con n√∫meros de puerto" },
                    { value: "solo_ip", label: "Usando √∫nicamente la direcci√≥n IP del host receptor" },
                    { value: "tcp_udp", label: "Combinando TCP y UDP para determinar a qu√© proceso enviar los datos" },
                    { value: "orden_paquetes", label: "Ordenando los paquetes en el mismo orden en que llegaron sin diferenciar procesos" }
                ],
                correct_answer: "multiplexacion",
                checked: false,
                score_value: 1,
                pista:"Observ√° c√≥mo la capa de Transporte distingue entre distintos procesos en el mismo host, ¬øqu√© mecanismo podr√≠a usar?",
                correct_msg: "¬°Correcto! La capa de Transporte usa multiplexaci√≥n y desmultiplexaci√≥n para entregar los datos al proceso adecuado seg√∫n el n√∫mero de puerto.",
                incorrect_msg: "Incorrecto. Para entregar los datos que recibe de capa de red usa multiplexaci√≥n y desmultiplexaci√≥n "
            },

            {
                id: 6,
                type: "drag_drop",
                text: "Arrastra cada campo de la cabecera TCP al tama√±o de bits correspondiente",
                drag_items: [
                    { value: "ventana", label: "Ventana de recepci√≥n" },
                    { value: "num_secuencia", label: "N√∫mero de secuencia" },
                    { value: "longitud_cabecera", label: "Longitud de cabecera" }
                ],
                drop_zones: [
                    { function: "ventana_bits16", label: "Campo de 16 bits", active: true },
                    { function: "num_secuencia_bits32", label: "Campo de 32 bits", active: true },
                    { function: "longitud_cabecera_bits4", label: "Campo de 4 bits", active: true }
                ],
                correct_map: {
                    ventana_bits16: "ventana",
                    num_secuencia_bits32: "num_secuencia",
                    longitud_cabecera_bits4: "longitud_cabecera"
                },

                checked: false,
                score_value: 1,
                pista:"El campo de tama√±o m√°s chico corresponde a la longitud de cabecera. El n√∫mero de secuencia, expresado en bytes, ocupa 4.",
                correct_msg: "¬°Excelente! Cada campo est√° en el tama√±o correcto.",
                incorrect_msg: "Incorrecto. Revisa bien los tama√±os de los campos de la cabecera TCP."
            },
            // Pregunta id 7 ‚Äì Capa de Transporte con im√°genes
            {
                id: 7,
                type: "drag_drop",
                text: "Arrastr√° el nombre del segmento a la imagen correspondiente.",
                drag_items: [
                    { value: "TCP", label: "Segmento TCP" },
                    { value: "UDP", label: "Segmento UDP" }
                ],
                drop_zones: [
                    {
                        function: "tcp_zone",
                        //label: "Segmento TCP", 
                        image: window.QUIZ_CONFIG.imgSegmentoTCP,
                        active: true
                    },
                    {
                        function: "udp_zone",
                        // label: "Segmento UDP", 
                        image: window.QUIZ_CONFIG.imgSegmentoUDP,
                        active: true
                    }
                ],
                correct_map: {
                    tcp_zone: "TCP",
                    udp_zone: "UDP"
                },
                checked: false,
                score_value: 1,
                pista:"TCP es confiable y orientado a conexi√≥n, UDP es no confiable y sin conexi√≥n.",
                correct_msg: "¬°Correcto! Identificaste correctamente los segmentos TCP y UDP.",
                incorrect_msg: "Incorrecto. Revis√° las estructuras de los segmentos."
            },
            //
            {
                id: 8,
                type: "mc", // multiple-choice
                text: "Marque los servicios que NO se ofrecen en la capa de transporte de Internet. (2 opciones)",
                options: [
                    { value: "reliable_delivery", label: "Entrega confiable y en orden (TCP)" },
                    { value: "congestion_control", label: "Control de congesti√≥n" },
                    { value: "flow_control", label: "Control de flujo" },
                    { value: "connection_setup", label: "Establecimiento de conexi√≥n" },
                    { value: "guaranteed_delay", label: "Garant√≠as de retardo" },
                    { value: "guaranteed_bandwidth", label: "Garant√≠as de ancho de banda" }
                ],
                correct_answer: ["guaranteed_delay", "guaranteed_bandwidth"], // las que no se ofrecen
                checked: false,
                score_value: 1,
                pista:"Reflexion√° sobre lo siguiente: ¬øInternet puede asegurar tiempos de entrega o que los datos viajen a una velocidad constante?",
                correct_msg: "¬°Correcto! La capa de transporte no garantiza retardo ni ancho de banda.",
                incorrect_msg: "Incorrecto. La capa de transporte lo que no garantiza es retardo ni ancho de banda."
            }, {
                id: 9,
                type: "mc", // multiple-choice simple
                text: "¬øQu√© representa esta imagen?",
                image: window.QUIZ_CONFIG.imgCierreConexion, // ruta de la imagen
                options: [
                    { value: "connection_close", label: "Cierre de una conexi√≥n" },
                    { value: "connection_setup", label: "Establecimiento de conexi√≥n" },
                    { value: "retransmission", label: "Retransmisi√≥n" }
                ],
                correct_answer: "connection_close",
                checked: false,
                score_value: 1,
                pista:"El flag FIN, significa que el dispositivo termin√≥ de enviar datos y desea finalizar la conexi√≥n.",
                correct_msg: "¬°Correcto! La imagen representa el cierre de una conexi√≥n TCP.",
                incorrect_msg: "Incorrecto. Revisa para que se usa cada Flag."
            },

            {
                id: 10,
                type: "drag_drop",
                text: "Arrastr√° el nombre correcto a cada concepto descrito abajo.",
                drag_items: [
                    { value: "seq", label: "N√∫mero de secuencia" },
                    { value: "ack", label: "Reconocimiento (ACK)" },
                    { value: "checksum", label: "Suma de comprobaci√≥n (checksum)" }
                ],
                drop_zones: [
                    {
                        function: "seq_zone",
                        label: "Se emplea para numerar secuencialmente los paquetes de datos que fluyen del emisor hacia el receptor.",
                        active: true
                    },
                    {
                        function: "ack_zone",
                        label: "El receptor utiliza estos paquetes para indicar al emisor que un paquete o un conjunto de paquetes ha sido recibido correctamente. ",
                        active: true
                    },
                    {
                        function: "checksum_zone",
                        label: " Utilizada para detectar errores de bit en un paquete transmitido.",
                        active: true
                    }
                ],
                correct_map: {
                    seq_zone: "seq",
                    ack_zone: "ack",
                    checksum_zone: "checksum"
                },
                checked: false,
                score_value: 1,
                pista:"El n√∫mero de secuencia ordena los datos, una de las otras opciones confirma la recepci√≥n y la otra detecta errores",
                correct_msg: "¬°Correcto! Identificaste correctamente los tres conceptos.",
                incorrect_msg: "Incorrecto. Revis√° los conceptos de TCP: cada uno tiene un rol distinto en la transmisi√≥n de datos."
            },

{
  id: 11,
  type: "drag_drop",
  text: "Clasific√° las siguientes caracter√≠sticas seg√∫n el protocolo confiable al que pertenecen (GBN o SR).",

  drag_items: [
    { value: "A", label: "Descarta paquetes recibidos fuera de orden." },
    { value: "B", label: "Almacena en buffer paquetes fuera de orden." },
    { value: "C", label: "Utiliza ACK acumulativos." },
    { value: "D", label: "Reduce la cantidad de retransmisiones." }
  ],

  drop_zones: [
    { function: "gbn_1", label: "", active: true },
    { function: "sr_1",  label: "", active: true },

    { function: "gbn_2", label: "", active: true },
    { function: "sr_2",  label: "", active: true }
  ],

  correct_map: {
    gbn_1: "A",
    gbn_2: "C",
    sr_1: "B",
    sr_2: "D"
  },

  checked: false,
  score_value: 1,

  pista: "Uno de los protocolos guarda paquetes fuera de orden para evitar retransmisiones innecesarias. El otro solo reconoce lo recibido en secuencia.",
  correct_msg: "¬°Excelente! Clasificaste correctamente las caracter√≠sticas de GBN y SR.",
  incorrect_msg: "Incorrecto. Revis√° qu√© protocolo usa buffer y cu√°l utiliza ACK acumulativos."
}


        ];
    </script>

    <script src="{% static 'aplicacion/estudiante/juego_capa_2.js' %}"></script>
    {% else %}
    <h1>Acceso Denegado</h1>
    <p>Necesitas iniciar sesi√≥n para ver esta p√°gina.</p>
    </div>
    {% endif %}

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-inner">
            <!-- Bloque izquierdo: Marca + cr√©ditos -->
            <div class="footer-left">
                <p class="footer-brand">Aventura TCP/IP</p>
                <p class="footer-meta">
                    Desarrollado por: Coria Luz Antonella, Proserpio Eliana Naily y Ana Paula Machado
                </p>
                <p class="footer-meta">
                    Asignatura Optativa: Inform√°tica Educativa ¬∑ Licenciatura en Sistemas de Informaci√≥n ¬∑ UNSE ¬∑ 2025
                </p>
                <!-- Bibliograf√≠a -->
                <p class="footer-meta footer-biblio">
                    Basado en contenidos de: Redes de Computadoras. Un Enfoque Descendente (7ma Ed.)
                </p>
                <!-- Uso √©tico de IA -->
                <p class="footer-meta footer-ai">
                    Herramientas de apoyo utilizadas: ChatGPT, Gemini y NotebookLM
                </p>
            </div>
            <!-- Bloque derecho: etiquetas -->
            <div class="footer-right">
                <span class="footer-tag">Proyecto acad√©mico</span>
                <span class="footer-tag footer-role">Versi√≥n 1.0</span>
            </div>
        </div>
    </footer>
</body>

</html>