{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nivel 2: Capa de Transporte</title>
    
    <!-- Favicon para Nivel 2 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöö</text></svg>">
    
    <link rel="stylesheet" href="{% static 'aplicacion/estudiante/niveles.css' %}">
    <link rel="stylesheet" href="{% static 'aplicacion/style.css' %}">
</head>
<body>
    {% if user.is_authenticated %}
    
    <h1 class="title" style="margin-top: 30px; margin-bottom: 10px;">AVENTURA TCP/IP: CARRERA DE CAPAS üèÅ</h1>

    <div class="game-area">
        
        <div class="game-profile-meta">
            Jugando como: <strong>{{ user.alias|default:user.username }}</strong> | Rol: {{ user.rol }}
        </div>
        
        <h2 style="color: #0077B6; margin-bottom: 5px;">Nivel 2: Capa de Transporte</h2>
        <p style="text-align: center; font-style: italic; margin-bottom: 15px;">Pregunta <span id="current-q-number">1</span> de 10. ¬°Cada acierto te acerca a la Fibra √ìptica!</p>
        
        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <form id="quiz-form" onsubmit="return false;"> 
            <div id="questions-container">
                </div>
            
            <div id="score-results" style="display: none;">
                <div class="score-display">Puntuaci√≥n Final: <span id="final-score"></span>/10</div>
                <div id="feedback-final" class="feedback"></div>
                
                <div id="review-container">
                    <h4>Revisi√≥n Detallada (Aciertos y Errores)</h4>
                    <div id="review-list"></div>
                </div>
            </div>

            <div class="nav-controls">
                <button type="button" id="prev-btn" disabled>‚Üê Anterior</button>
                <button type="button" id="check-btn">Verificar</button>
                <button type="button" id="next-btn" disabled>Siguiente ‚Üí</button>
                <button type="button" id="finish-btn" style="display:none;">Finalizar</button>
            </div>
        </form>

        <a href="{% url 'perfil_estudiante' %}" class="link-return" style="display: block; margin-top: 20px;">Volver al Men√∫ de Niveles</a>
    </div>

    <script>
        window.QUIZ_CONFIG = {
          saveResultUrl: "{% url 'save_quiz_result' %}",
          imgFibra: "{% static 'aplicacion/images/fibra.svg' %}",
          imgCat6: "{% static 'aplicacion/images/cat6.svg' %}",
          imgCat35: "{% static 'aplicacion/images/cat3_5.svg' %}"
        };

        // --------- BANCO DE PREGUNTAS (10 preguntas fijas de Capa de Transporte) ---------
        window.QUIZ_QUESTIONS = [
            // P1: DRAG & DROP - Funci√≥n a Protocolo
            { id: 1, type: 'drag_drop', text: "P1. ¬°Asocia la funci√≥n de transporte con el Protocolo que la realiza!",
        drag_items: [
            { value: 'puerto_', label: 'N√∫mero de puerto' },
            { value: 'control_f', label: 'Control de flujo' },
            { value: 'segment_', label: 'Segmentaci√≥n' }
        ],
        drop_zones: [
            { function: 'puerto', label: 'Identificador que permite dirigir los datos a la aplicaci√≥n correcta' },
            { function: 'controlf', label: 'Mecanismo que evita que el emisor sature al receptor' },
            { function: 'segment', label: 'Proceso de dividir mensajes en unidades m√°s peque√±as para transmitir' }
        ],
        correct_map: { 'puerto': 'puerto_', 'controlf': 'control_f', 'segment': 'segment_' },
        answer: {}, checked: false, score_value: 1
    },
            // P2: OPCI√ìN M√öLTIPLE
            { id: 2, type: 'mc', text: "P2. ¬øCu√°l es el protocolo de la Capa de Transporte que garantiza la entrega confiable de datos?", options: ['UDP', 'TCP', 'IP', 'HTTP'], correct_answer: 'TCP', explanation: "TCP (Transmission Control Protocol) es el protocolo que garantiza la entrega confiable de datos mediante confirmaciones y retransmisiones.", answer: null, checked: false, score_value: 1 },
            // P3: VERDADERO/FALSO
            { id: 3, type: 'tf', text: "P3. V/F: UDP es un protocolo orientado a conexi√≥n que garantiza la entrega ordenada de los datos.", options: ['Verdadero', 'Falso'], correct_answer: 'Falso', explanation: "Falso. UDP es un protocolo sin conexi√≥n (connectionless) que no garantiza la entrega ni el orden de los datos.", answer: null, checked: false, score_value: 1 },
            // P4: OPCI√ìN M√öLTIPLE
            { id: 4, type: 'mc', text: "P4. ¬øCu√°l es la PDU (Unidad de Datos de Protocolo) principal que maneja la Capa de Transporte?", options: ['Paquetes', 'Tramas', 'Segmentos', 'Bits'], correct_answer: 'Segmentos', explanation: "La Capa de Transporte trabaja con 'Segmentos', que son las unidades de datos que encapsula esta capa.", answer: null, checked: false, score_value: 1 },
            // P5: VERDADERO/FALSO
            { id: 5, type: 'tf', text: "P5. V/F: El puerto 80 es el puerto est√°ndar utilizado para el protocolo HTTP.", options: ['Verdadero', 'Falso'], correct_answer: 'Verdadero', explanation: "Verdadero. El puerto 80 es el puerto est√°ndar para HTTP (Hypertext Transfer Protocol).", answer: null, checked: false, score_value: 1 },
            // P6: OPCI√ìN M√öLTIPLE
            { id: 6, type: 'mc', text: "P6. ¬øQu√© protocolo de transporte es m√°s adecuado para aplicaciones en tiempo real como videollamadas?", options: ['TCP', 'UDP', 'IP', 'FTP'], correct_answer: 'UDP', explanation: "UDP es m√°s adecuado para aplicaciones en tiempo real porque tiene menor latencia al no tener que esperar confirmaciones.", answer: null, checked: false, score_value: 1 },
            // P7: VERDADERO/FALSO
            { id: 7, type: 'tf', text: "P7. V/F: TCP utiliza un mecanismo de ventana deslizante para controlar el flujo de datos.", options: ['Verdadero', 'Falso'], correct_answer: 'Verdadero', explanation: "Verdadero. TCP utiliza ventana deslizante (sliding window) para controlar el flujo y evitar saturar al receptor.", answer: null, checked: false, score_value: 1 },
            // P8: OPCI√ìN M√öLTIPLE
            { id: 8, type: 'mc', text: "P8. ¬øCu√°l es el rango de puertos bien conocidos (well-known ports)?", options: ['0-1023', '1024-49151', '49152-65535', '0-65535'], correct_answer: '0-1023', explanation: "Los puertos bien conocidos van del 0 al 1023 y est√°n reservados para servicios est√°ndar.", answer: null, checked: false, score_value: 1 },
            // P9: VERDADERO/FALSO
            { id: 9, type: 'tf', text: "P9. V/F: El handshake de tres v√≠as (three-way handshake) es utilizado por UDP para establecer conexiones.", options: ['Verdadero', 'Falso'], correct_answer: 'Falso', explanation: "Falso. El handshake de tres v√≠as es utilizado por TCP, no por UDP. UDP no establece conexiones.", answer: null, checked: false, score_value: 1 },
            // P10: OPCI√ìN M√öLTIPLE
            { id: 10, type: 'mc', text: "P10. ¬øQu√© funci√≥n principal cumple la Capa de Transporte en el modelo TCP/IP?", options: ['Enrutamiento de paquetes', 'Comunicaci√≥n extremo a extremo entre aplicaciones', 'Transmisi√≥n f√≠sica de bits', 'Detecci√≥n de errores en tramas'], correct_answer: 'Comunicaci√≥n extremo a extremo entre aplicaciones', explanation: "La Capa de Transporte proporciona comunicaci√≥n extremo a extremo (end-to-end) entre procesos de aplicaci√≥n.", answer: null, checked: false, score_value: 1 }
        ];
    </script>
      <script src="{% static 'aplicacion/estudiante/juego_capa_2.js' %}"></script>
    {% else %}
        <h1>Acceso Denegado</h1>
        <p>Necesitas iniciar sesi√≥n para ver esta p√°gina.</p>
    </div>
    {% endif %}
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-inner">
            <!-- Lado izquierdo (marca + info) -->
            <div class="footer-left">
                <p class="footer-brand">Aventura TCP/IP</p>
                <p class="footer-meta">
                    Desarrollado por: Coria Luz Antonella, Proserpio Eliana Naily y Ana Paula Machado
                </p>
                <p class="footer-meta">
                    Inform√°tica Educativa ¬∑ Licenciatura en Sistemas de Informaci√≥n ¬∑ UNSE ¬∑ 2025
                </p>
            </div>
            <!-- Lado derecho (tags estilo moderno) -->
            <div class="footer-right">
                <span class="footer-tag">Proyecto acad√©mico</span>
                <span class="footer-tag footer-role">Versi√≥n 1.0</span>
            </div>
        </div>
    </footer>
</body>
</html>
