{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nivel 3: Capa de Red</title>
    
    <!-- Favicon para Nivel 3 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåê</text></svg>">
    
    <link rel="stylesheet" href="{% static 'aplicacion/estudiante/niveles.css' %}">
    <link rel="stylesheet" href="{% static 'aplicacion/style.css' %}">
    <link rel="stylesheet" href="{% static 'aplicacion/estudiante/capa3.css' %}">
</head>
<body>
    {% if user.is_authenticated %}
    
    <h1 class="title" style="margin-top: 30px; margin-bottom: 10px;">AVENTURA TCP/IP: CARRERA DE CAPAS üèÅ</h1>

    <div class="game-area">
        
        <div class="game-profile-meta">
            Jugando como: <strong>{{ user.alias|default:user.username }}</strong> | Rol: {{ user.rol }}
        </div>
        
        <h2 style="color: #0077B6; margin-bottom: 5px;">Nivel 3: Capa de Red</h2>
        <p style="text-align: center; font-style: italic; margin-bottom: 15px;">Pregunta <span
                id="current-q-number">1</span> de <span id="total-questions">20</span>. ¬°Cada acierto te acerca a la Fibra √ìptica!</p>
        
        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <form id="quiz-form" onsubmit="return false;">
            <div id="questions-container">
            </div>

            <div id="score-results" style="display: none;">
                <div class="score-display">Puntuaci√≥n Final: <span id="final-score"></span>/<span id="final-total">20</span></div>
                <div id="feedback-final" class="feedback"></div>
                
                <div id="review-container">
                    <h4>Revisi√≥n Detallada (Aciertos y Errores)</h4>
                    <div id="review-list"></div>
                </div>
            </div>

            <div class="nav-controls">
                <button type="button" id="prev-btn" disabled>‚Üê Anterior</button>
                <button type="button" id="check-btn">Verificar</button>
                <button type="button" id="next-btn" disabled>Siguiente ‚Üí</button>
                <button type="button" id="finish-btn" style="display:none;">Finalizar</button>
            </div>
        </form>

        <a href="{% url 'perfil_estudiante' %}" class="link-return" style="display: block; margin-top: 20px;">Volver al
            Men√∫ de Niveles</a>
    </div>

    <script>
      window.QUIZ_CONFIG = {
        saveResultUrl: "{% url 'save_quiz_result' %}",
        imgFibra: "{% static 'aplicacion/images/fibra.svg' %}",
        imgCat6: "{% static 'aplicacion/images/cat6.svg' %}",
        imgCat35: "{% static 'aplicacion/images/cat3_5.svg' %}"
      };
    
      // --------- BANCO DE PREGUNTAS (20 preguntas fijas de Capa de Red) ---------
  window.QUIZ_QUESTIONS = [
    // 1
    {
      id: 1,
      type: "mc",
      text: "En la arquitectura de Internet, ¬øc√≥mo se denomina a la unidad de informaci√≥n (paquete) procesada espec√≠ficamente en la capa de red?",
      options: [
        "Mensaje",
        "Segmento",
        "Datagrama",
        "Trama"
      ],
      correct_answer: "Datagrama",
      pista:
        "Pens√° en el nombre que recibe el paquete cuando ya est√° en la Capa de Red, despu√©s de que la Capa de Transporte le entrega un segmento.",
      explanation:
        "En el contexto de la Capa de Red, la unidad de datos se denomina datagrama IP."
    },
    // 2
    {
      id: 2,
      type: "tf",
      text: "La funci√≥n de reenv√≠o (forwarding) se refiere a la l√≥gica global de la red que determina la ruta que siguen los datagramas, mientras que el enrutamiento (routing) es la acci√≥n local de mover un paquete de una interfaz de entrada a una de salida.",
      options: ["Verdadero", "Falso"],
      correct_answer: "Falso",
      pista:
        "Record√° que una de estas funciones es local, en cada router, y la otra es global, a nivel de toda la red.",
      explanation:
        "Forwarding es la acci√≥n local en cada router (mover de entrada a salida). Routing es el c√°lculo de rutas globales (algoritmos y protocolos de enrutamiento)."
    },
    // 3
    {
      id: 3,
      type: "sequence",
      text:
        "Un router recibe un datagrama IPv4 de 4000 bytes y debe enviarlo por un enlace con MTU de 1500 bytes. Ordene cronol√≥gicamente lo que sucede con los fragmentos.",
      sequence_items: [
        {
          key: "viajan",
          label: "Los fragmentos viajan de forma independiente por la red."
        },
        {
          key: "reensambla",
          label:
            "El host de destino reensambla los fragmentos para recuperar el datagrama original."
        },
        {
          key: "divide",
          label:
            "El router divide la carga √∫til y crea fragmentos m√°s peque√±os ajustando el campo de desplazamiento."
        },
        {
          key: "recibe",
          label: "El host de destino recibe los fragmentos."
        }
      ],
      correct_sequence: ["divide", "viajan", "recibe", "reensambla"],
      pista:
        "Pens√° qu√© sucede primero en el router, qu√© pasa en el camino y qu√© acciones realiza reci√©n el host de destino.",
      explanation:
        "Para mantener la red simple, los routers fragmentan los datagramas grandes, mientras que el reensamblado ocurre √∫nicamente en el host de destino."
    },
    // 4
    {
      id: 4,
      type: "mc",
      text:
        "Un datagrama queda atrapado en un bucle de enrutamiento entre tres routers. ¬øQu√© mecanismo del encabezado IPv4 evita que circule para siempre?",
      options: [
        "El campo de Suma de Comprobaci√≥n (Checksum).",
        "El campo Tiempo de Vida (TTL).",
        "El protocolo de enrutamiento OSPF.",
        "El campo de Desplazamiento de fragmentaci√≥n."
      ],
      correct_answer: "El campo Tiempo de Vida (TTL).",
      pista:
        "Hay un campo que se va reduciendo en cada salto hasta que el paquete ‚Äúexpira‚Äù.",
      explanation:
        "El campo Time To Live (TTL) se reduce en cada salto; si llega a cero, el router descarta el datagrama para evitar bucles infinitos."
    },
    // 5
    {
      id: 5,
      type: "drag_drop",
      text:
        "Empareja cada concepto con su definici√≥n seg√∫n el modelo de servicio de Internet.",
      drag_items: [
        { value: "A", label: "Direcci√≥n IP" },
        { value: "B", label: "Interfaz" },
        { value: "C", label: "Subred" }
      ],
      drop_zones: [
        {
          function: "def1",
          label: "L√≠mite entre el host/router y el enlace f√≠sico."
        },
        {
          function: "def2",
          label: "Identificador de 32 bits asociado a una interfaz."
        },
        {
          function: "def3",
          label:
            "Red aislada creada desconectando las interfaces de sus hosts/routers, donde las interfaces pueden comunicarse sin pasar por un router."
        }
      ],
      correct_map: {
        def1: "B",
        def2: "A",
        def3: "C"
      },
      pista:
        "Record√° que la direcci√≥n IP no identifica al equipo completo sino a cada interfaz. Y la subred es el conjunto de interfaces que se pueden comunicar sin pasar por un router.",
      explanation:
        "A-2: Direcci√≥n IP ‚Üí identificador de 32 bits. B-1: Interfaz ‚Üí l√≠mite entre host/router y enlace f√≠sico. C-3: Subred ‚Üí conjunto de interfaces que pueden comunicarse sin pasar por un router."
    },
    // 6
    {
      id: 6,
      type: "mc",
      text:
        "Un router recibe un paquete con destino 11001000 00010111 00011000 10101010. En su tabla de reenv√≠o hay dos entradas que coinciden: una para el prefijo 11001000 00010111 (16 bits) y otra para 11001000 00010111 00011 (21 bits). ¬øQu√© regla aplica para elegir la interfaz de salida?",
      options: [
        "First Match (Primera coincidencia en la lista).",
        "Random Selection (Selecci√≥n aleatoria).",
        "Longest Prefix Match (Coincidencia con el prefijo m√°s largo)."
      ],
      correct_answer: "Longest Prefix Match (Coincidencia con el prefijo m√°s largo).",
      pista:
        "Cuando hay varias coincidencias, el router elige la entrada m√°s espec√≠fica, no la primera que encuentra.",
      explanation:
        "En el reenv√≠o IP se usa la regla de Longest Prefix Match para seleccionar la entrada m√°s espec√≠fica en la tabla de reenv√≠o."
    },
    // 7
    {
      id: 7,
      type: "tf",
      text:
        "A diferencia de IPv4, el protocolo IPv6 permite que los routers intermedios fragmenten datagramas demasiado grandes para el enlace de salida.",
      options: ["Verdadero", "Falso"],
      correct_answer: "Falso",
      pista:
        "¬øQui√©n tiene la responsabilidad de adaptar el tama√±o del paquete en IPv6: los routers intermedios o los hosts extremos?",
      explanation:
        "IPv6 elimin√≥ la fragmentaci√≥n en routers intermedios. S√≥lo los extremos (hosts) pueden fragmentar, lo que simplifica el procesamiento en la red."
    },
    // 8
    {
      id: 8,
      type: "mc",
      text:
        "Un host reci√©n conectado a una red necesita obtener una direcci√≥n IP. ¬øCu√°l es el orden correcto de los mensajes DHCP?",
      options: [
        "Request -> Offer -> Discover -> Ack",
        "Discover -> Offer -> Request -> Ack",
        "Discover -> Request -> Offer -> Ack"
      ],
      correct_answer: "Discover -> Offer -> Request -> Ack",
      pista:
        "El cliente primero ‚Äúanuncia‚Äù que busca servidor, luego recibe una propuesta, m√°s tarde solicita formalmente y al final llega la confirmaci√≥n.",
      explanation:
        "El flujo DHCP est√°ndar es DORA: el cliente descubre (Discover), el servidor ofrece (Offer), el cliente pide (Request) y el servidor confirma (Ack)."
    },
    // 9
    {
      id: 9,
      type: "mc",
      text:
        "En una red dom√©stica 10.0.0.0/24 un host env√≠a un datagrama a Google. ¬øQu√© cambia el router NAT en el datagrama antes de enviarlo a la WAN?",
      options: [
        "Solo la direcci√≥n IP de origen.",
        "La direcci√≥n IP de origen y el n√∫mero de puerto de origen.",
        "La direcci√≥n IP de destino y el puerto de destino."
      ],
      correct_answer: "La direcci√≥n IP de origen y el n√∫mero de puerto de origen.",
      pista:
        "Pens√° en c√≥mo el NAT logra que muchos equipos internos compartan una sola direcci√≥n p√∫blica.",
      explanation:
        "El router NAT traduce la IP y el puerto de origen para mapear la conexi√≥n interna (privada) a una conexi√≥n externa (p√∫blica) en su tabla de traducci√≥n."
    },
    // 10
    {
      id: 10,
      type: "tf",
      text:
        "El modelo de servicio de la capa de red de Internet se describe como 'Best-effort', lo que garantiza un ancho de banda m√≠nimo y entrega en orden, aunque no garantiza retardos.",
      options: ["Verdadero", "Falso"],
      correct_answer: "Falso",
      pista:
        "¬øBest-effort garantiza algo o simplemente hace ‚Äúlo mejor que puede‚Äù sin comprometerse a nada?",
      explanation:
        "El servicio Best-effort de la Capa de Red de Internet no ofrece garant√≠as de entrega, orden, ancho de banda ni tiempos de retardo."
    },
    // 11
    {
      id: 11,
      type: "drag_drop",
      text:
        "Empareja el algoritmo de enrutamiento con su caracter√≠stica principal.",
      drag_items: [
        { value: "A", label: "Estado de Enlace (Link-State)" },
        { value: "B", label: "Vector de Distancias (Distance-Vector)" }
      ],
      drop_zones: [
        {
          function: "car1",
          label:
            "Es descentralizado; los nodos solo conocen los costes a sus vecinos directos e intercambian vectores de estimaciones."
        },
        {
          function: "car2",
          label:
            "Es centralizado; cada nodo necesita un mapa completo de la red y los costes de todos los enlaces."
        }
      ],
      correct_map: {
        car1: "B",
        car2: "A"
      },
      pista:
        "Uno se basa en informaci√≥n global de toda la topolog√≠a, el otro se apoya en intercambiar informaci√≥n √∫nicamente con los vecinos.",
      explanation:
        "Link-State suele implementarse con Dijkstra y requiere informaci√≥n global. Distance-Vector se basa en Bellman-Ford y s√≥lo intercambia vectores con vecinos."
    },
    // 12
    {
      id: 12,
      type: "mc",
      text:
        "¬øCu√°l de los siguientes protocolos se utiliza para el enrutamiento entre sistemas aut√≥nomos (Inter-AS) y se considera el 'pegamento' de Internet?",
      options: ["OSPF", "RIP", "BGP", "ICMP"],
      correct_answer: "BGP",
      pista:
        "Pens√° en el protocolo que usan los grandes proveedores de Internet para intercambiar rutas entre redes distintas a nivel global.",
      explanation:
        "BGP (Border Gateway Protocol) es el protocolo de enrutamiento utilizado entre sistemas aut√≥nomos en Internet."
    },
    // 13
    {
      id: 13,
      type: "mc",
      text:
        "Ejecutas el comando Traceroute para ver la ruta hacia un servidor. ¬øQu√© protocolo se utiliza para recibir los mensajes de error 'TTL excedido' que revelan los routers intermedios?",
      options: ["TCP", "DHCP", "ICMP", "ARP"],
      correct_answer: "ICMP",
      pista:
        "Traceroute se apoya en mensajes de error de red cuando el TTL llega a cero, no en el mismo protocolo que se usa para transferir la p√°gina web.",
      explanation:
        "Traceroute usa datagramas con TTL crecientes. Cuando el TTL llega a 0, los routers generan mensajes ICMP 'Time Exceeded' que permiten descubrir el camino."
    },
    // 14
    {
      id: 14,
      type: "tf",
      text:
        "En una Red Definida por Software (SDN), el plano de control se separa f√≠sicamente del router y se ejecuta en un controlador remoto centralizado.",
      options: ["Verdadero", "Falso"],
      correct_answer: "Verdadero",
      pista:
        "En este enfoque, los dispositivos de red se vuelven m√°s simples y la ‚Äúinteligencia‚Äù se mueve a un componente central.",
      explanation:
        "SDN desacopla el plano de control del de datos. El controlador centralizado programa las tablas de reenv√≠o de los dispositivos."
    },
    // 15
    {
      id: 15,
      type: "sequence",
      text:
        "Ordena el recorrido de un paquete dentro de la arquitectura de un router gen√©rico.",
      sequence_items: [
        { key: "out", label: "Puerto de salida (Output Port)." },
        {
          key: "proc_out",
          label: "Procesamiento de salida (encapsulado capa de enlace)."
        },
        { key: "in", label: "Puerto de entrada (Input Port)." },
        { key: "fabric", label: "Entramado de conmutaci√≥n (Switching Fabric)." }
      ],
      correct_sequence: ["in", "fabric", "out", "proc_out"],
      pista:
        "Imagin√° el camino: primero el paquete entra al router, luego atraviesa la parte interna que decide por d√≥nde salir, despu√©s llega al puerto de salida y reci√©n ah√≠ se prepara para el medio f√≠sico.",
      explanation:
        "El flujo t√≠pico es: Input Port ‚Üí Switching Fabric ‚Üí Output Port ‚Üí procesamiento de salida (cola, encapsulado y transmisi√≥n)."
    },
    // 16
    {
      id: 16,
      type: "mc",
      text:
        "En el contexto de SDN y OpenFlow, la tabla de reenv√≠o tradicional se sustituye por una tabla de flujo que opera bajo el concepto de:",
      options: [
        "Store and Forward (Almacenamiento y reenv√≠o).",
        "Match plus Action (Correspondencia m√°s Acci√≥n).",
        "Best Effort (Mejor esfuerzo)."
      ],
      correct_answer: "Match plus Action (Correspondencia m√°s Acci√≥n).",
      pista:
        "Cada entrada de la tabla indica con qu√© campos del paquete debe coincidir y qu√© hacer si se cumple esa condici√≥n.",
      explanation:
        "En OpenFlow, cada entrada de la tabla de flujo define condiciones de coincidencia (match) y acciones (action) a aplicar a los paquetes."
    },
    // 17
    {
      id: 17,
      type: "tf",
      text:
        "En el protocolo OSPF, un router difunde la informaci√≥n del estado de sus enlaces a todos los routers del sistema aut√≥nomo, no solo a sus vecinos directos.",
      options: ["Verdadero", "Falso"],
      correct_answer: "Verdadero",
      pista:
        "Este protocolo busca que todos los routers tengan el mismo mapa de la red, por eso la informaci√≥n se 'inunda' en el sistema aut√≥nomo.",
      explanation:
        "OSPF distribuye informaci√≥n de estado de enlace mediante inundaci√≥n para que cada router tenga una base de datos de topolog√≠a id√©ntica."
    },
    // 18
    {
      id: 18,
      type: "mc",
      text:
        "¬øC√≥mo se llama el problema en algoritmos de Vector de Distancia donde una 'mala noticia' (como la ca√≠da de un enlace) tarda mucho en propagarse, generando bucles temporales?",
      options: [
        "Cuenta hasta el infinito.",
        "Bloqueo de cabeza de l√≠nea (HOL).",
        "Inundaci√≥n SYN."
      ],
      correct_answer: "Cuenta hasta el infinito.",
      pista:
        "Es el problema cl√°sico que aparece en muchos ejemplos de Distance-Vector y motiva t√©cnicas como 'split horizon'.",
      explanation:
        "En 'count to infinity', los routers aumentan progresivamente el costo hacia un destino inalcanzable antes de detectar que est√° ca√≠do."
    },
    // 19
    {
      id: 19,
      type: "mc",
      text:
        "En un router llegan paquetes de VoIP y de descarga de archivos (FTP). El router siempre env√≠a primero VoIP y solo atiende FTP si no hay VoIP en cola. ¬øQu√© pol√≠tica de planificaci√≥n est√° usando?",
      options: [
        "FIFO (First-In-First-Out).",
        "Round Robin.",
        "Colas con Prioridad.",
        "WFQ (Weighted Fair Queuing)."
      ],
      correct_answer: "Colas con Prioridad.",
      pista:
        "Una de estas pol√≠ticas siempre atiende primero una clase de tr√°fico antes que las dem√°s.",
      explanation:
        "En colas con prioridad, los paquetes de la clase m√°s alta (VoIP) se transmiten antes que los de baja prioridad (FTP)."
    },
    // 20
    {
      id: 20,
      type: "tf",
      text:
        "El campo Protocolo en el encabezado IPv4 indica el protocolo de la capa de enlace (como Ethernet o Wi-Fi) que transportar√° el datagrama.",
      options: ["Verdadero", "Falso"],
      correct_answer: "Falso",
      pista:
        "Este campo sirve para 'decidir a qu√© protocolo de la capa superior se le entregan los datos' (por ejemplo TCP o UDP).",
      explanation:
        "El campo Protocolo del encabezado IPv4 indica el protocolo de la Capa de Transporte al que se debe entregar el contenido (por ejemplo, TCP=6, UDP=17)."
    }
  ];
    </script>
    

    <script src="{% static 'aplicacion/estudiante/juego_capa_3.js' %}"></script>
    {% else %}
        <h1>Acceso Denegado</h1>
        <p>Necesitas iniciar sesi√≥n para ver esta p√°gina.</p>
    {% endif %}

    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-inner">
            <!-- Bloque izquierdo: Marca + cr√©ditos -->
            <div class="footer-left">
                <p class="footer-brand">Aventura TCP/IP</p>
                <p class="footer-meta">
                    Desarrollado por: Coria Luz Antonella, Proserpio Eliana Naily y Ana Paula Machado
                </p>
                <p class="footer-meta">
                    Asignatura Optativa: Inform√°tica Educativa ¬∑ Licenciatura en Sistemas de Informaci√≥n ¬∑ UNSE ¬∑ 2025
                </p>
                <!-- Bibliograf√≠a -->
                <p class="footer-meta footer-biblio">
                    Basado en contenidos de: Redes de Computadoras. Un Enfoque Descendente (7ma Ed.)
                </p>
                <!-- Uso √©tico de IA -->
                <p class="footer-meta footer-ai">
                    Herramientas de apoyo utilizadas: ChatGPT, Gemini y NotebookLM
                </p>
            </div>
            <!-- Bloque derecho: etiquetas -->
            <div class="footer-right">
                <span class="footer-tag">Proyecto acad√©mico</span>
                <span class="footer-tag footer-role">Versi√≥n 1.0</span>
            </div>
        </div>
    </footer>
</body>
</html>

